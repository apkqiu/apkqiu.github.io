import{_ as i,C as n,c as E,o as t,j as a,b as P,a6 as s,a as o,w as r,G as c,a7 as p}from"./chunks/framework.DUQqqwoy.js";const A="/assets/wechat_2025-07-21_094650_107.DmiBCeh8.png",D=JSON.parse('{"title":"原理","description":"","frontmatter":{},"headers":[],"relativePath":"_gfw/techlonogy.md","filePath":"_gfw/techlonogy.md","lastUpdated":1753063427000}'),d={name:"_gfw/techlonogy.md"};function T(S,e,h,I,m,u){const l=n("Mermaid");return t(),E("div",null,[e[1]||(e[1]=a("h1",{id:"原理",tabindex:"-1"},[o("原理 "),a("a",{class:"header-anchor",href:"#原理","aria-label":'Permalink to "原理"'},"​")],-1)),e[2]||(e[2]=a("h2",{id:"典型国际网络访问顺序",tabindex:"-1"},[o("典型国际网络访问顺序 "),a("a",{class:"header-anchor",href:"#典型国际网络访问顺序","aria-label":'Permalink to "典型国际网络访问顺序"'},"​")],-1)),(t(),P(p,null,{default:r(()=>[c(l,{id:"mermaid-6",class:"mermaid",graph:"flowchart%20TB%0AEE(%22%E4%BD%A0%E7%9A%84%E8%AE%BE%E5%A4%87%22)%0AEE--%3EA((%22%E4%BD%A0%E7%9A%84%E8%B7%AF%E7%94%B1%E5%99%A8%22))%0AA--%3EB(%22%E4%B8%AD%E7%BB%A7%22)%0AB--%3EGFW%5B%22GFW%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83%22%5D%0AGFW--%3EISP%5B%22ISP%E5%9B%BD%E9%99%85%E5%87%BA%E5%85%A5%E5%8F%A3%22%5D%0AISP--%3ESEA%5B%22%E6%B5%B7%E5%BA%95%E7%94%B5%E7%BC%86%22%5D%0ASEA--%3EC%5B%22%E5%A4%96%E5%9B%BD%E4%B8%AD%E7%BB%A7%22%5D%0AC--%3EOUT%5B%22%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8%22%5D%0AOUT--%3EC%0AC--%3ESEA%0ASEA--%3EISP%0AISP--%3EGFW%0AGFW--%3EB%0AB--%3EA%0AA--%3EEE%0A%0A"})]),fallback:r(()=>e[0]||(e[0]=[o(" Loading... ")])),_:1})),e[3]||(e[3]=s('<h2 id="_1-网域服务器缓存污染" tabindex="-1">1. 网域服务器缓存污染 <a class="header-anchor" href="#_1-网域服务器缓存污染" aria-label="Permalink to &quot;1. 网域服务器缓存污染&quot;">​</a></h2><p>等待到深度包检测章节中的“和处于域名黑名单中的相匹配”的域名后，防火长城会向查询者注入虚假DNS回复，比真的更早到达。由于通常的域名查询没有任何认证机制，而且域名查询通常基于的UDP协议是无连接不可靠的协议，查询者无法验证返回结果的正确性，客户端接受其伪造回复，并尝试连接其中的IP，结果往往是超时，或者出现无效TLS证书之警告。而其对TCP协议的查询则使用TCP重置攻击来阻止获得任何正确结果。</p><p>此种行为自2002年开始以来有相当明确的特征。</p><ul><li>伪造回复所包含的IP地址或者是保留地址、或者是固定中国境外IP集合中的一个，这些地址通常已经被屏蔽。</li><li>伪造回复包有固定类型。一型的TTL值和IPID固定，每次注入出现1个；二型的TTL值周期性增加、IPID递减，每次注入出现3个。两种类型都没有设置“不分片”（Don&#39;t fragment）选项。另外，2020年的研究指出有另一种新的IPID和TTL值都随机，带有“不分片”选项的回复存在。 这种注入是双向的，不仅是在中国境内查询境外DNS时、境外的DNS查询途经中国时也会出现，这导致许多国外递归DNS服务器的缓存被污染。</li></ul><p>根据2014年的研究，防火长城的一个计算集群有360个节点，每个节点的平均处理速度是每秒2800个DNS包。</p><p>对于加密DNS，如DoT和DoH，防火长城使用基于IP端口和基于SNI的封锁。最早的封锁针对Cloudflare提供的加密DNS服务，其一个IP地址1.1.1.1和域名cloudflare-dns.com在2020年末被发现封锁。</p><h3 id="相关事件" tabindex="-1">相关事件 <a class="header-anchor" href="#相关事件" aria-label="Permalink to &quot;相关事件&quot;">​</a></h3><ul><li>2010年3月，一名智利域名注册商的技术人员称，当用户向的“I”根域名服务器的查询facebook.com、youtube.com和twitter.com等域名时，返回的是虚假的IP地址，没有转到VeriSign公司运行的.com。调查表明，由于错误的路由信息，用户的对此根服务器的域名查询被定向到一个中国的节点，“I”根服务器运营商Netnod为解决问题，撤回了中国服务器的路由通告，并声称自己的服务器本身不包含任何错误路由，安全专家亦认为这次事件与Netnod无关，而是中国政府修改某处网络时造成的。4月，一家中国ISP的错误路由通告再次扩大了DNS污染对全世界的影响。6月，匿名研究发现109个国家的三成递归DNS解析器受到防火长城污染，中国周边地区如俄罗斯、东南亚最受影响。Slashdot网友认为，中国的DNS污染是互联网的真正威胁。</li><li>2014年1月21日下午三点半，中国互联网域名解析异常，大量网站被错误解析到IP地址65.49.2.178，这个IP位于美国加利福尼亚州费利蒙市Hurricane Electric公司，被动态网公司租用于翻墙软件连接节点。动态网公司和研究人员认为这是因为防火长城的工作人员操作失误，另一些人认为，不能排除真正的黑客借这一IP地址作为跳板发动攻击的可能。</li><li>2015年1月2日，污染方式有所改变，防火长城不再注入固定、被封锁IP地址，而是境外真实网站的、可访问的地址，这导致了境外服务器遭受来自中国的DDoS攻击，部分网站因此屏蔽中国IP。该年4月，CNCERT发表声明称，劫持是境外攻击所致。</li></ul><h2 id="_2-tcp重置攻击" tabindex="-1">2. TCP重置攻击 <a class="header-anchor" href="#_2-tcp重置攻击" aria-label="Permalink to &quot;2. TCP重置攻击&quot;">​</a></h2><p>重置（reset）是传输控制协议（TCP）的一种消息，例如服务器端在没有客户端请求的端口或者其它连接信息不符时，系统的TCP协议栈就会给客户端回复一个重置通知消息，该功能本来用于应对例如服务器意外重启等情况，而防火长城阻止TCP连接的技术实际上就是比连接双方更快地发送连接重置消息，使连接双方以为对方终止了连接。</p><p>Chromium的“连接被重置”错误消息。当碰触到GFW设置的关键词后（如使用Google等境外搜索引擎），会出现这种画面。</p><p><img src="'+A+'" alt="."></p><p>当GFW看到自客户端发送的第一个SYN包以启动TCP三次握手时，其开始跟踪该TCP连接的状态。HTTP、SMTP、HTTPS等许多应用协议都基于TCP。GFW在该TCP控制块（TCP control block）内进行上文所述之检测，遇到预期关键字后，其会注入带有一个RST选项的“一型”和多个带有RST/ACK选项的“二型”数据包，这被认为是来自两种同时部署的审查设备。一型IPID为0，具有随机的窗口尺寸，没有设置“不分片”选项；二型则有周期性增加的TTL值和窗口尺寸，并且设置了“不分片”。</p><p>有时防火长城在检测到违禁关键字并注入一次重置后，会在固定时长内对具有相同三元组（客户端IP、服务器IP、服务器端口）的连接不区分关键字违禁与否地持续注入，或者丢弃符合该三元组的数据包，这被称为残余审查（Residual censorship）。前谷歌高级副总裁艾伦·尤斯塔斯曾发布视频演示此种封锁策略。</p><h2 id="_3-ip封锁" tabindex="-1">3. IP封锁 <a class="header-anchor" href="#_3-ip封锁" aria-label="Permalink to &quot;3. IP封锁&quot;">​</a></h2><p>防火长城主要采用路由扩散技术封锁特定IP地址，也就是通过将需要拦截的IP地址配置为空路由、黑洞设备或特别配置的自治系统上，在这些黑洞服务器上可以什么也不做，或者对这些报文进行分析和统计，获取更多的信息，甚至可以做出虚假回应。正常的情况下，静态路由是由管理员根据网络拓扑或是基于其它目的而给出的一条路由，所以这条路由是正确的情况下，可以引导路由器把报文转发到正确的目的地。而防火长城的路由扩散技术中使用的静态路由是一条有意配置错误的路由，其目的是为了把本来是发往某个IP地址的报文引导到一个“黑洞服务器”上，而不是把它们转发到正确目的地。通过动态路由协议的路由重分发功能，这些错误的路由信息可以发布到整个网络。</p><blockquote><p>在大规模自治域的出入口路由器上新接入一个起控管作用的子网或者AS域，将要受控的网络地址配置在这个子网或者AS域内的路由器中，这样利用动态路由协议的网络拓扑自动识别特性，在出入口路由器上将生成受控网络地址的路由信息，将自治域内部网络对这些受控网络地址的访问转入到这个控管子网或者AS域的网络中，从而实现对受控网络地址的流量控制 。</p></blockquote><p>对于由使用虚拟主机服务提供商提供的多域名、单（同）IP的主机托管服务的网站，如果封禁它的IP地址，就会造成“过度封锁”（Overblocking）：所有使用该提供商服务的、其他使用相同IP地址的网站也被封锁，就算是“内容健康、政治无关”的网站，也不能幸免。其中的内容可能并无不当之处，但也不能在中国大陆正常访问。所以基于路由封锁的方法现在主要用于针对自主拥有大量连续地址段的特定自治系统，例如Facebook，Google，Telegram，Twitter等；对于内容分发网络（CDN）的地址段可能不会采用这种地址封锁的方法，以避免过度封锁。</p><h2 id="_4-主动探测" tabindex="-1">4. 主动探测 <a class="header-anchor" href="#_4-主动探测" aria-label="Permalink to &quot;4. 主动探测&quot;">​</a></h2><p>自2011年10月以来，防火长城通过主动探测（Active probing）识别翻墙服务器，并随后将其封锁。其主要针对以下目标。</p><ul><li>任何加密连接，包括SSH和Tor，并不针对特定协议。这是最早出现的探测。每当中国用户尝试加密连接，防火长城发送“垃圾二进制（garbage binary）探针”，一系列伪随机数据，在建立加密连接前先访问目标计算机，其目的在于在用户建立加密连接前嗅探出他们所使用的反审查工具，任何从中国访问境外HTTPS 443端口的连接都会在几乎实时的情况下被刺探。</li><li>Tor。2011年10月起，防火长城的深度包检测设备已能识别Tor指纹。当中国的Tor客户端试图与境外Tor网桥建立连接，防火长城会在每15分钟周期（如15分钟后，30分钟后）内发送探针会尝试与Tor进行SSL协商和重协商，但目的不是建立Tor连接，每次探测持续3分钟。这种探测还会在春节等假期期间停止。而2015年的研究指出，防火长城已经可以实时主动探测Tor网桥，而不是每15分钟执行一次。被探测的网桥类型包括obfs2和obfs3等。</li><li>SoftEther VPN。2015年9月发现。起初使用固定的IP，如210.72.128.200[注 2]，被屏蔽之后使用亚马逊EC2等云服务发起探测，模仿SoftEther的客户端握手去识别有效的SoftEther的IP。</li><li>AppSpot。2015年9月发现，目的是为了识别并封锁可用的Google的IP，干扰使用该服务翻墙的GoAgent。探测请求有相似的Host头和固定的用户代理。</li><li>Shadowsocks。可能是从2019年5月开始的。</li></ul><h2 id="_5-间歇性封锁国际出口" tabindex="-1">5. 间歇性封锁国际出口 <a class="header-anchor" href="#_5-间歇性封锁国际出口" aria-label="Permalink to &quot;5. 间歇性封锁国际出口&quot;">​</a></h2><p>2011年5月，中国大陆境内很多互联网公司以及高校、学院、科研单位的对外网络连接都出现问题，包括中国科学院。当时有分析指断网可能是因为防火长城已经具有了探测和分析大量加密流量并对用户IP地址执行封锁的能力，而各大机构的出口被封也在其中。具体表现为：当用户使用了破网（翻墙）软件后，其所在的公共网络IP地址会被临时封锁，所有的国际网站都无法访问，包括MSN、iTunes Store等，而访问国内网站却正常，但如果使用境外的DNS解析域名则将会由于DNS服务器被封锁导致无法解析任何域名，国内网站也会无法打开。自由亚洲电台引述业内人士分析指，此举是中国当局在测试逐步切断大部分人访问国际网站的措施，以试探用户反应并最终达到推行网络“白名单”制，也就是凡没有在名单上的企业或团体其网络域名将不能解析，一般用户也无法访问。而中共党机关报《人民日报》旗下的《环球时报》英文版则引述方滨兴指，一些ISP必须为自己的用户支付国际流量费用，因此这些公司“有动机”去阻碍用户访问国外网站。一位不愿留名的工信部官员说，用户碰到这些情况应先检查自己和网站的技术问题。</p><h2 id="_6-中间人攻击" tabindex="-1">6. 中间人攻击 <a class="header-anchor" href="#_6-中间人攻击" aria-label="Permalink to &quot;6. 中间人攻击&quot;">​</a></h2><p>2013年1月26日，有中国大陆的用户在访问GitHub时发现证书无效，经检查发现，其的证书变为了一自签署的X.509证书，生成时间为2013年1月25日，有效期一年，故有人推测GitHub疑似遭到了中间人攻击。 GreatFire和研究人员认为攻击是由中国政府策划的。</p><p>自2014年8月28日起，原先可以通过IPv6直连Google的中国教育网（CERNET）内试图通过HTTPS连接*.google.com.*等网页时，可能收到TLS证书错误的提示，其中以连接www.google.com.hk几乎是每次连接均收到攻击，而其它连接例如ipv6.google.com和accounts.google.com也有受到攻击的报告，但攻击发生的几率相对较低。伪造的TLS证书显示其为google.com，颁发机构即为其本身，与真正的证书不同，显示谷歌在中国教育网上受到中间人攻击。</p><p>2015年1月17日，Outlook遭到了中间人攻击。19日，GreatFire撰文称怀疑此攻击是由网信办发起的；22日，网信办对此文作出了回应，称“Greatfire.org是境外反华组织创办的反华网站”，“这一无端臆测，纯属境外反华势力的造谣和污蔑”。</p>',27))])}const _=i(d,[["render",T]]);export{D as __pageData,_ as default};
